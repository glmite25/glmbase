<!DOCTYPE html>
<html>
<head>
    <title>Superadmin Access Fix</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .success { color: green; background: #f0fff0; padding: 10px; border: 1px solid green; margin: 10px 0; }
        .error { color: red; background: #fff0f0; padding: 10px; border: 1px solid red; margin: 10px 0; }
        .info { color: blue; background: #f0f0ff; padding: 10px; border: 1px solid blue; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 300px; }
        #output { margin-top: 20px; padding: 10px; background: #f5f5f5; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîß Superadmin Access Fix for ojidelawrence@gmail.com</h1>
    
    <div class="info">
        <strong>Instructions:</strong>
        <ol>
            <li>Click "Grant Permanent Superadmin Access" to set your superadmin status</li>
            <li>Enter your credentials and test login</li>
            <li>Your superadmin status will persist across browser sessions</li>
        </ol>
    </div>

    <div>
        <button onclick="grantSuperadminAccess()" style="background: #4CAF50; color: white; font-weight: bold;">
            üöÄ Grant Permanent Superadmin Access
        </button>
        <button onclick="checkSuperadminStatus()" style="background: #2196F3; color: white;">
            ‚úÖ Check Current Status
        </button>
        <button onclick="clearAllData()" style="background: #f44336; color: white;">
            üóëÔ∏è Clear All Data
        </button>
    </div>

    <hr>

    <h3>Test Login</h3>
    <div>
        <input type="email" id="email" placeholder="ojidelawrence@gmail.com" value="ojidelawrence@gmail.com"><br>
        <input type="password" id="password" placeholder="Your password" value="Fa-#8rC6DRTkd$5"><br>
        <button onclick="testLogin()" style="background: #FF9800; color: white;">üîê Test Login</button>
        <button onclick="signOut()" style="background: #9E9E9E; color: white;">üö™ Sign Out</button>
    </div>

    <div id="output"></div>

    <script>
        const supabaseUrl = 'https://wnxclsslqgonczgtiwav.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndueGNsc3NscWdvbmN6Z3Rpd2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzMjc1MDksImV4cCI6MjA2MDkwMzUwOX0.AF2JNk8B1pYeA7hYjm-ZLCGbq0W4iOQXxv93x1LTmFc';
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        const SUPERADMIN_EMAIL = 'ojidelawrence@gmail.com';
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            output.textContent += `${timestamp} ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function grantSuperadminAccess() {
            log('üöÄ Granting permanent superadmin access...', 'info');
            
            try {
                // Set superadmin status in localStorage (this is what the app checks)
                localStorage.setItem('glm-is-superuser', 'true');
                localStorage.setItem('glm-superadmin-email', SUPERADMIN_EMAIL);
                localStorage.setItem('glm-superadmin-granted', new Date().toISOString());
                
                // Also set in sessionStorage for immediate effect
                sessionStorage.setItem('glm-is-superuser', 'true');
                sessionStorage.setItem('glm-superadmin-email', SUPERADMIN_EMAIL);
                
                // Set additional flags that the app might check
                localStorage.setItem('glm-auth-role', 'superuser');
                localStorage.setItem('glm-user-role', 'superuser');
                localStorage.setItem('glm-admin-access', 'true');
                
                log('‚úÖ SUCCESS! Permanent superadmin access granted!', 'success');
                log(`‚úÖ Email: ${SUPERADMIN_EMAIL}`, 'success');
                log('‚úÖ Role: superuser', 'success');
                log('‚úÖ Admin access: enabled', 'success');
                log('‚úÖ Status will persist across browser sessions', 'success');
                
                // Verify the settings
                checkSuperadminStatus();
                
            } catch (error) {
                log('‚ùå Error granting superadmin access: ' + error.message, 'error');
            }
        }
        
        function checkSuperadminStatus() {
            log('üîç Checking current superadmin status...', 'info');
            
            const isSuperuser = localStorage.getItem('glm-is-superuser') === 'true';
            const storedEmail = localStorage.getItem('glm-superadmin-email');
            const grantedDate = localStorage.getItem('glm-superadmin-granted');
            const authRole = localStorage.getItem('glm-auth-role');
            const userRole = localStorage.getItem('glm-user-role');
            const adminAccess = localStorage.getItem('glm-admin-access');
            
            log('üìä Current Status:', 'info');
            log(`   Superuser: ${isSuperuser ? '‚úÖ YES' : '‚ùå NO'}`, isSuperuser ? 'success' : 'error');
            log(`   Email: ${storedEmail || 'Not set'}`, storedEmail ? 'success' : 'error');
            log(`   Granted: ${grantedDate || 'Not set'}`, grantedDate ? 'success' : 'info');
            log(`   Auth Role: ${authRole || 'Not set'}`, authRole === 'superuser' ? 'success' : 'info');
            log(`   User Role: ${userRole || 'Not set'}`, userRole === 'superuser' ? 'success' : 'info');
            log(`   Admin Access: ${adminAccess === 'true' ? '‚úÖ YES' : '‚ùå NO'}`, adminAccess === 'true' ? 'success' : 'info');
            
            // Check hardcoded superuser list (from the app's superuser-fix.js)
            const superUserEmails = [
                'ojidelawrence@gmail.com',
                'clickcom007@yahoo.com',
                'popsabey1@gmail.com'
            ];
            
            const isHardcodedSuperuser = superUserEmails.includes(SUPERADMIN_EMAIL.toLowerCase());
            log(`   Hardcoded Superuser: ${isHardcodedSuperuser ? '‚úÖ YES' : '‚ùå NO'}`, isHardcodedSuperuser ? 'success' : 'error');
            
            if (isSuperuser && isHardcodedSuperuser) {
                log('üéâ You have FULL superadmin access!', 'success');
            } else if (isHardcodedSuperuser) {
                log('‚ö†Ô∏è You are hardcoded as superuser but localStorage not set', 'error');
            } else {
                log('‚ùå Superadmin access not properly configured', 'error');
            }
        }
        
        async function testLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                log('‚ùå Please enter both email and password', 'error');
                return;
            }
            
            log(`üîê Testing login for: ${email}`, 'info');
            
            try {
                // Clear any existing session first
                await supabase.auth.signOut();
                log('üßπ Cleared existing session', 'info');
                
                // Attempt login
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email.toLowerCase(),
                    password: password
                });
                
                if (error) {
                    log(`‚ùå Login failed: ${error.message}`, 'error');
                    
                    if (error.message.includes('Invalid login credentials')) {
                        log('üí° This could mean:', 'info');
                        log('   ‚Ä¢ Email not found in the system', 'info');
                        log('   ‚Ä¢ Password is incorrect', 'info');
                        log('   ‚Ä¢ Account exists but password was changed', 'info');
                        log('   ‚Ä¢ Account not properly created', 'info');
                    }
                } else {
                    log('‚úÖ Login successful!', 'success');
                    log(`‚úÖ User ID: ${data.user.id}`, 'success');
                    log(`‚úÖ Email: ${data.user.email}`, 'success');
                    log(`‚úÖ Email confirmed: ${data.user.email_confirmed_at ? 'Yes' : 'No'}`, 'success');
                    
                    // Ensure superadmin status is set after successful login
                    if (email.toLowerCase() === SUPERADMIN_EMAIL.toLowerCase()) {
                        grantSuperadminAccess();
                        log('üöÄ Superadmin status automatically applied after login!', 'success');
                    }
                }
            } catch (err) {
                log(`‚ùå Login exception: ${err.message}`, 'error');
            }
        }
        
        async function signOut() {
            try {
                await supabase.auth.signOut();
                log('üö™ Signed out successfully', 'success');
                
                // Keep superadmin status even after signout
                log('‚ÑπÔ∏è Superadmin status preserved for next login', 'info');
            } catch (err) {
                log(`‚ùå Sign out error: ${err.message}`, 'error');
            }
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to clear all stored data? You will need to re-grant superadmin access.')) {
                localStorage.clear();
                sessionStorage.clear();
                log('üóëÔ∏è All stored data cleared', 'info');
                log('‚ö†Ô∏è You will need to grant superadmin access again', 'info');
            }
        }
        
        // Auto-check status on page load
        window.onload = function() {
            log('üîß Superadmin Access Fix Tool Loaded', 'info');
            log('üë§ Target User: ojidelawrence@gmail.com', 'info');
            checkSuperadminStatus();
        };
    </script>
</body>
</html>