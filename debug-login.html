<!DOCTYPE html>
<html>

<head>
    <title>Login Debug Tool</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body>
    <h2>Login Debug Tool</h2>
    <div>
        <label>Email: <input type="email" id="email" placeholder="your.email@example.com"></label><br><br>
        <label>Password: <input type="password" id="password" placeholder="Your password"></label><br><br>
        <button onclick="testLogin()">Test Login</button>
        <button onclick="checkUser()">Check User Status</button>
        <button onclick="clearStorage()">Clear Storage</button>
    </div>
    <div id="output" style="margin-top: 20px; padding: 10px; background: #f5f5f5; white-space: pre-wrap;"></div>

    <script>
        const supabaseUrl = 'https://wnxclsslqgonczgtiwav.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndueGNsc3NscWdvbmN6Z3Rpd2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzMjc1MDksImV4cCI6MjA2MDkwMzUwOX0.AF2JNk8B1pYeA7hYjm-ZLCGbq0W4iOQXxv93x1LTmFc';

        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        async function testLogin() {
            const email = document.getElementById('email').value.toLowerCase();
            const password = document.getElementById('password').value;

            if (!email || !password) {
                log('Please enter both email and password');
                return;
            }

            log('Testing login for: ' + email);

            try {
                // Clear any existing session first
                await supabase.auth.signOut();
                log('Cleared existing session');

                // Attempt login
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    log('Login error: ' + error.message);
                    log('Error code: ' + (error.code || 'none'));

                    // Check for specific error types
                    if (error.message.includes('Invalid login credentials')) {
                        log('This usually means either:');
                        log('1. Email not found in the system');
                        log('2. Password is incorrect');
                        log('3. Account exists but password was changed');
                    } else if (error.message.includes('Email not confirmed')) {
                        log('Account exists but email not confirmed');
                    } else if (error.message.includes('Too many requests')) {
                        log('Rate limited - wait a few minutes');
                    }
                } else {
                    log('Login successful!');
                    log('User ID: ' + data.user.id);
                    log('Email: ' + data.user.email);
                    log('Email confirmed: ' + data.user.email_confirmed_at);
                }
            } catch (err) {
                log('Exception: ' + err.message);
            }
        }

        async function checkUser() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (user) {
                    log('Currently logged in as: ' + user.email);
                    log('User ID: ' + user.id);
                } else {
                    log('No user currently logged in');
                }
            } catch (err) {
                log('Error checking user: ' + err.message);
            }
        }

        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            log('Cleared browser storage');
        }
    </script>
</body>

</html>